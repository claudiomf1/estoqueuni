# docker-compose.dev.yml
# Override para ambiente de desenvolvimento
# Use com: docker compose -f docker-compose.base.yml -f docker-compose.dev.yml up

services:
  # Backend Principal - Dev
  estoqueuni-backend:
    environment:
      - NODE_ENV=development
      - CORS_ORIGIN=http://localhost:8080
      # Redis (para BullMQ)
      - REDIS_HOST=redis
      - REDIS_PORT=6379
      - REDIS_PASSWORD=${REDIS_PASSWORD:-}
      - REDIS_DB=${REDIS_DB:-0}
    # Bind mount do código para hot reload
    volumes:
      - ./backend/src:/app/src:ro
      - ./backend/package.json:/app/package.json:ro
    # Expor porta no host para debug
    ports:
      - "3001:3000"

  # Backend AI - Dev
  estoqueuni-backend-ai:
    environment:
      - NODE_ENV=development
      - CORS_ORIGIN=http://localhost:8080
    # Bind mount do código para hot reload
    volumes:
      - ./backend-ai/src:/app/src:ro
      - ./backend-ai/config:/app/config:ro
      - ./backend-ai/package.json:/app/package.json:ro
    # Expor porta no host para debug
    ports:
      - "3002:3000"

  # Frontend - Dev
  estoqueuni-frontend:
    # Em dev, podemos rebuildar mais facilmente
    # ou usar bind mount se preferir hot reload completo
    # volumes:
    #   - ./frontend/src:/app/src:ro
    ports:
      - "8080:80"

  # Nginx Proxy - Dev
  nginx-proxy:
    ports:
      - "80:80"
    # Recarregar configuração mais facilmente em dev
    volumes:
      - ./nginx/nginx.dev.conf:/etc/nginx/conf.d/default.conf:ro
      # Diretório vazio para suprimir scripts padrão do entrypoint (evita logs/avisos desnecessários)
      - ./nginx/entrypoint-empty:/docker-entrypoint.d:ro
    environment:
      # Evita aviso do script 10-listen-on-ipv6-by-default.sh alterando default.conf
      - ENABLE_IPV6=false
      - DISABLE_IPV6=true

  # Redis - Dev (sem mudanças, mas pode adicionar persistência diferente se quiser)
